{% extends 'base.html' %}

{% block title %}
    {% if user.is_authenticated %}My Todos{% else %}Home{% endif %} - Todo App
{% endblock %}

{% block content %}
    {% if user.is_authenticated %}
        {# --- Add Todo Form --- #}
        <h2>Add a New Todo</h2>
        <form method="post" action="{% url 'home' %}">
             {% csrf_token %}
             {{ add_todo_form.as_p }}
             <button type="submit">Add Todo</button>
        </form>

        <hr style="margin: 30px 0;">

        {# --- Todo List --- #}
        <h2>My Todos</h2>
        {% if todo_list %}
            <ul style="list-style: none; padding: 0;">
                {% for todo in todo_list %}
                    <li style="border: 1px solid #eee; padding: 15px; margin-bottom: 10px; border-radius: 5px; background-color: {% if todo.status == 'DONE' %}#e8f5e9{% else %}#f9f9f9{% endif %};"> {# Change background if done #}
                        <strong style="text-decoration: {% if todo.status == 'DONE' %}line-through{% else %}none{% endif %};"> {# Strikethrough if done #}
                            {{ todo.title }}
                        </strong>
                        ({{ todo.get_status_display }}) {# Shows 'Pending' or 'Done' #}
                        <br>
                        {% if todo.description %}
                            <small style="color: #555;">{{ todo.description }}</small><br>
                        {% endif %}
                        <small style="color: #888;">Added: {{ todo.created_at|date:"Y-m-d H:i" }}</small>

                        {# --- Action Buttons within Forms --- #}
                        <div style="margin-top: 10px;">
                            {# Update Status Form/Button #}
                            <form method="post" action="{% url 'update_todo_status' todo.id %}" style="display: inline;">
                                {% csrf_token %}
                                <button type="submit">
                                    {% if todo.status == 'DONE' %}Mark Pending{% else %}Mark Done{% endif %}
                                </button>
                            </form>

                            {# Delete Form/Button #}
                            <form method="post" action="{% url 'delete_todo' todo.id %}" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this item?');">
                                {% csrf_token %}
                                <button type="submit" style="color: white; background-color: #dc3545; border-color: #dc3545; cursor: pointer;">Delete</button>
                            </form>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>You haven't added any todos yet. Add one above!</p>
        {% endif %}

    {% else %}
        {# --- User is Not Logged In --- #}
        <h2>Welcome to the Todo App!</h2>
        <p>Please <a href="{% url 'login' %}">login</a> or <a href="{% url 'signup' %}">sign up</a> to manage your todos.</p>
    {% endif %}
{% endblock %}